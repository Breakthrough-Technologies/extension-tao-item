
const URI={'ENDORSMENT':'##NAMESPACE#ENDORSMENT','SUBJECT':'http://www.tao.lu/Ontologies/TAOSubject.rdf#Subject','ITEM':'http://www.tao.lu/Ontologies/TAOItem.rdf#Item','PROCESS':'http://www.tao.lu/middleware/taoqual.rdf#i119010455660544'};function TaoStack(){this.dataSource=new Object();this.dataSource.environment={'type':'async','url':'/tao/Api/getContext','params':{}};this.dataSource.settings={'format':'json','method':'post','load':'onInit'};this.dataStore={'token':'','localNamspace':'','processUri':'','item':{'uri':'','label':''},'subject':{'uri':'','login':'','firstname':'','lastname':''}};this.initDataSource=function(environment,settings,source){if($.inArray(environment.type,['manual','sync','async'])){this.dataSource.environment.type=environment.type;if(this.dataSource.environment.type!='manual'&&environment.url){if(/(\/[-a-z\d%_.~+]*)*(\?[;&a-z\d%_.~+=-]*)?(\#[-a-z\d_]*)?$/.test(url)){this.dataSource.environment.url=url;if($.isPlainObject(environment.params)){for(key in params){if(isScalar(environment.params[key])){this.dataSource.environment.params[key]=environment.params[key]+'';}}}}
if($.isPlainObject(settings)){if(settings.method){if(/^get|post$/i.test(settings.method)){this.dataSource.settings.method=settings.method;}}}}
if(this.dataSource.settings.load=='onInit'){this.loadData(source);}}};this.loadData=function(source){var populateData=function(instance,data){if($.isPlainObject(data)){for(key in instance.dataStore){if(data[key]){instance.dataStore[key]=data[key];}}
if(instance.dataStore.subject){this.setTaoVar(URI.SUBJECT,instance.dataStore.subject);}
if(instance.dataStore.item){this.setTaoVar(URI.ITEM,instance.dataStore.item);}}}
if(this.dataSource.environment.type=='manual'&&source){populateData(this,source);}
else{var params=this.dataSource.environment.params;var instance=this;$.ajax({'url':this.dataSource.environment.url,'data':params,'type':this.dataSource.settings.method,'async':(this.dataSource.environment.type=='async'),'dataType':this.dataSource.settings.format,'success':function(data){populateData(instance,data);}});}};this.push=new Object();this.push.environment={'url':'/tao/Api/save','params':{'token':this.dataStore.token,'processUri':this.dataStore.processUri,'itemUri':this.dataStore.item.uri,'subjectUri':this.dataStore.subject.uri}};this.push.settings={'format':'json','method':'post','async':true,'clearAfter':true};this.initPush=function(environment,settings){if(environment.url){if(/(\/[-a-z\d%_.~+]*)*(\?[;&a-z\d%_.~+=-]*)?(\#[-a-z\d_]*)?$/.test(environment.url)){this.push.environment.url=environment.url;if($.isPlainObject(environment.params)){for(key in environment.params){if(isScalar(environment.params[key])&&!this.push.environment.params[key]){this.push.environment.params[key]=environment.params[key];}}}
if($.isPlainObject(settings)){if(settings.method){if(/^get|post$/i.test(settings.method)){this.push.settings.method=settings.method;}}
if(settings.async===false){this.push.settings.async=false;}
if(settings.clearAfter===false){this.push.settings.clearAfter=false;}}}}};this.push=function(){var params=this.push.environment.params;for(key in this.taoVars){if(/^##NAMESPACE#/.test(key)){key=key.replace('##NAMESPACE#',this.dataStore.localNamespace);}
params['taoVars'][key]=this.taoVars[key];}
var instance=this;$.ajax({'url':this.push.environment.url,'data':params,'type':this.push.settings.method,'async':this.push.settings.async,'dataType':this.push.settings.format,'success':function(data){if(data.saved){if(instance.push.settings.clearAfter){instance.taoVars=new Object();instance.userVars=new Object();}}}});};this.taoVars=new Object();this.getTaoVar=function(key){return(this.taoVars[key])?this.taoVars[key]:false;};this.setTaoVar=function(key,value){if(isScalar(value)){this.taoVars[key]=value;}};this.userVars=new Object();this.getUserVar=function(key){return(this.userVars[key])?this.userVars[key]:false;};this.setUserVar=function(key,value){if(isScalar(value)){this.userVars[key]=value;}};}
function isScalar(value){switch((typeof value).toLowerCase()){case'string':case'number':case'boolean':return true;default:return false;}
return false;}
var taoStack=new TaoStack();function getEndorsement(){return taoStack.getTaoVar(URI.ENDORSMENT);}
function setEndorsement(endorsement){taoStack.setTaoVar(URI.ENDORSMENT,(endorsement==true));}
function getSubject(){return taoStack.getTaoVar(URI.SUBJECT);}
function getItem(){return taoStack.getTaoVar(URI.ITEM);}
function getUserVar(key){return taoStack.getUserVar(key);}
function setUserVar(key,value){taoStack.setUserVar(key,value);}
function setEvent(e){}
function createVar(){}
function initDataSource(environment,settings){taoStack.initDataSource(environment,settings,null);}
function initManualDataSource(source){taoStack.initDataSource({type:'manual'},null,source);}
function initPush(environment,settings){taoStack.initPush(environment,settings);}
function push(){taoStack.push();}