{"version":3,"sources":["routes.js","json!taoItems/preview/resources/device-list.json","../preview/tpl/preview!tpl","../../taoItemsCss/preview!css","../preview/preview.js","items/action.js","items/edit.js","../../serviceApi/ServiceApi.js","../../serviceApi/PseudoStorage.js","../../serviceApi/UserInfoService.js","../runtime/ItemServiceImpl.js","../preview/actionBarHook.js","preview/itemRunner.js","runtime/itemRunner.js"],"names":["define","Items","deps","actions","editItem","ItemPreview","index","tablets","193986c3715c81838870f908fa98d69a","label","width","height","4e8eafab11aad1486992d7ee2c8c16ca","5aac2932d9ad00d6d8a1604b8f9e4e8d","9805d9753ad08c7630a9ee5418aa6c6c","d4a431cedf4705d6bf2cba6d5788378b","phones","1b89338531ef0155c8d6abc2ac02c81a","scaleFactor","dpWidth","dpHeight","3f89da99d84214cde7df87ebe0699a6f","0d36971a5b98b367f54ced708c9af849","026beffcc051af995660ebdede986ace","fd2dd53e667d6d49e4fa73356fa941dd","707584c1ae17d9b5b2cbe8603c91c147","91823264de952e7f2347e07db5c4058b","cd69817a6e147e8a4677389e56fcf568","75994faa6a38e31e99b53fcd75534a33","0cab4dfccdfc880687cb608cfe4159db","c4ff41fcba24d74fc21dc3490ca1edc9","fa969a5e0dd2de53700eeee4ba4ba142","33c4f9364e295ec03531f3a3425819cf","bc47f5275f0efd56fee52d43a8082981","0732887e6e324fd10777b735520a34cf","2e38a78364f09d0da0e9e1a3a68e7fb0","bd4b78dddc7c9625a4141a1b1ddabb87","3bf1edf21cfa81006183d2b02974c84e","ab5a352e0e016b97dac986f06c394f55","4826fb7d7257aeaac992ce699df41b3c","0a691ab20add7c432200f8fa6527b488","9c23ee31be29960fbac9e9bbfc2fc7b0","92177c0508c1d73905a58e2338f2a81f","5222b8866dc4cc606725e16ffcc0a783","37c1541e2bd55cfd0f4073b0ccdf68b3","2f7f64b7dda0144907ff300e83eed465","9c24f9057744dad56043702a9703127f","0a8b2732a016a9395c3af5f12dd9c0da","5a153d7f53d82dcb0801f041574a6a43","screens","9e523ae15b61dc766f5c818726881ecf","07769cd8d0a7d09818b2f0b018042fb7","72d5478a24194f98b9378e8e0fd65737","b7a6dd5900cc72e61f0d3479c7e314ec","43193b0ff671a37d8232ab664190a125","c29e48814af5443ff5688d9e967ce917","hb","template","Handlebars","depth0","helpers","partials","data","program1","stack1","helper","buffer","value","call","hash","functionType","escapeExpression","selected","inverse","self","noop","fn","program","program2","program4","each","themes","program6","dataValue","this","compilerInfo","merge","options","helperMissing","previewType","previewTypes","hasThemes","desktopDevices","mobileDevices","__","$","_","strPad","Promise","deviceList","previewTpl","themeHandler","themeLoader","_setupScreenSize","screenSize","innerWidth","innerHeight","overlay","container","typeDependant","$feedbackBox","$console","previewContainerMaxWidth","itemUri","orientation","desktop","mobile","standard","themeObj","get","$doc","document","$window","window","$body","body","sizeSettings","winScrollObj","x","y","_getDeviceSelectorData","type","devices","forEach","push","join","_setupTypeDependantElements","add","find","_setPreviewType","newType","re","RegExp","i","el","className","replace","_setOrientation","newOrientation","previewFrame","_scale","_computeScaleFactor","$scaleContainer","_scaleFactor","containerScaledWidth","left","css","-webkit-transform","-ms-transform","transform","-webkit-transform-origin","-ms-transform-origin","transform-origin","_positionPreview","topBarHeight","outerHeight","style","top","maxHeight","scaleValues","requiredSize","Math","min","_setupDeviceSelectors","previewDeviceSelectors","on","elem","option","nodeName","toLowerCase","selectedIndex","val","split","length","parseFloat","_adaptFrameSize","select2","minimumResultsForSearch","_setupOrientationSelectors","_setupClosers","$closer","$feedbackCloser","$hideForever","$iframe","trigger","scrollTo","hide","removeClass","off","attr","keyup","e","keyCode","addClass","preventDefault","cookie","expires","path","_getThemes","activeTheme","getActiveTheme","available","id","name","_getPreviewTypes","_previewLabel","_previewType","_setupViewSelector","_setupThemeSelector","iframe","getElementById","iframeDoc","contentWindow","contentDocument","$previewContainer","_iframe","contentHeight","contents","containerHeight","_updateStandardPreviewSize","$selector","values","toString","valueStr","_initConsole","$listing","event","message","timer","Date","logTime","getHours","getMinutes","getSeconds","msgStr","append","is","scrollTop","slideDown","show","slideUp","resolve","reject","ajax","url","dataType","done","scrollX","scrollY","display","not","html","fail","xhr","Error","status","statusText","init","_itemUri","TypeError","remove","size","parseInt","binder","uri","context","preview","register","actionContext","_url","shownExtension","module","lock","section","editItemController","start","config","previewAction","isPreviewEnabled","isAuthoringEnabled","getBy","authoringAction","state","disabled","updateState","sectionContext","exec","UrlParser","ServiceApi","baseUrl","parameters","serviceCallId","stateStorage","userService","paused","connected","hasBeenPaused","SIG_SUCCESS","SIG_ERROR","prototype","loadInto","frame","$frame","callUrl","getCallUrl","isCORSAllowed","checkCORS","connect","__knownParent__","onServiceApiReady","params","param","getUserPropertyValues","property","callback","getServiceCallId","getState","setState","set","getHasBeenPaused","setHasBeenPaused","getParameter","identifier","onFinish","onFinishCallback","onKill","onKillCallback","onExit","onExitCallback","kill","exit","finish","valueArray","PseudoStorage","UserInfoService","requestUrl","hasOwnProperty","success","service","r","key","ItemServiceImpl","itemId","serviceApi","resultApi","responses","scores","events","rawstate","parseJSON","stateVariables","beforeFinishCallbacks","itemApi","onItemApiReady","saveResponses","attrname","traceEvents","eventArray","saveScores","beforeFinish","submit","after","JSON","stringify","submitItemVariables","getVariable","setVariable","setVariables","v","errorHandler","isValidConfig","toolconfig","isObject","hook","triggerItemLoaded","tool","itemLoaded","initExtraButtons","$toolContainer","isString","tools","$toolContainers","require","$button","$existingBtn","isValidHook","children","clear","render","_appendInOrder","_ns","$container","$after","$before","order","prepend","isNaN","$btn","_order","before","reduce","result","method","isFunction","isValid","actionBarHook","_initCustomButtons","buttons","extraButtons","forIn","previewItemRunner","conf","previewUrl","resultServer","defaults","endpoint","ResultServerApi","resultServerApi","userInfoServiceRequestUrl","addParam","clientConfigUrl","getUrl","click","iframeNotifier","itemRunner","appendTo","itemPath","itemService","timeout","ItemService","setIframeHeight","newHeight","neverResized","resize","notifyParent","parent","delay","itemUrl","throttle","responseId","response","elmentId","defer"],"mappings":"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AAA,IAEAG,iBAAA,IACAvO,KAAA0I,cAAAgG,iBAAA,GAGA/N,EAAA,QAAAgF,GAAA,YAAA,SAAA6D,MAAAjO,QACA6a,gBAAA7a,YAGA6S,OAAAjH,KAAA,MAAAwP,QAAAhB;AZlGA,EYsGA/U,EAAAoW,MAAA,WACAnB,eAAAY,OAAA,qBAMA,OAAAX;AZ5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1TA,AD2TA;AC1TA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9GA,AD+GA;AC9GA;AACA,ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC7mBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvEA,ADwEA;ACvEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7LA,AD8LA;AC7LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpHA,ADqHA;ACpHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC/QA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"taoItems/controller/routes.js","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoItems/controller/routes',[],function(){\n    'use strict';\n\n    return {\n        'Items' : {\n            'deps' : 'controller/items/action',\n            'actions' : {\n                'editItem' : 'controller/items/edit'\n            }\n        },\n        'ItemPreview' : {\n            'actions' : {\n                'index' : 'controller/preview/itemRunner'\n            }\n        }\n    };\n});\n\n","\ndefine(\"json!taoItems/preview/resources/device-list.json\", function(){ return {\n    \"tablets\": {\n        \"193986c3715c81838870f908fa98d69a\": {\n            \"label\": \"Amazon Kindle Fire HDX 7\\u2033\",\n            \"width\": 960,\n            \"height\": 600\n        },\n        \"4e8eafab11aad1486992d7ee2c8c16ca\": {\n            \"label\": \"Apple iPad\",\n            \"width\": 1024,\n            \"height\": 768\n        },\n        \"5aac2932d9ad00d6d8a1604b8f9e4e8d\": {\n            \"label\": \"Google Nexus 10, Motorola Xoom, Xyboard\",\n            \"width\": 1280,\n            \"height\": 800\n        },\n        \"9805d9753ad08c7630a9ee5418aa6c6c\": {\n            \"label\": \"Google Nexus 7\",\n            \"width\": 966,\n            \"height\": 604\n        },\n        \"d4a431cedf4705d6bf2cba6d5788378b\": {\n            \"label\": \"Samsung Galaxy Tab 7.7, 8.9, 10.1\",\n            \"width\": 1280,\n            \"height\": 800\n        }\n    },\n    \"phones\": {\n        \"1b89338531ef0155c8d6abc2ac02c81a\": {\n            \"label\": \"Apple iPhone 3GS\",\n            \"width\": 320,\n            \"height\": 480,\n            \"scaleFactor\": 1,\n            \"dpWidth\": 320,\n            \"dpHeight\": 480\n        },\n        \"3f89da99d84214cde7df87ebe0699a6f\": {\n            \"label\": \"Apple iPhone 4\",\n            \"width\": 640,\n            \"height\": 960,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1920\n        },\n        \"0d36971a5b98b367f54ced708c9af849\": {\n            \"label\": \"Apple iPhone 5\",\n            \"width\": 640,\n            \"height\": 1136,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 320,\n            \"dpHeight\": 2272\n        },\n        \"026beffcc051af995660ebdede986ace\": {\n            \"label\": \"BlackBerry Z10\",\n            \"width\": 768,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 384,\n            \"dpHeight\": 2560\n        },\n        \"fd2dd53e667d6d49e4fa73356fa941dd\": {\n            \"label\": \"BlackBerry Z30\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 360,\n            \"dpHeight\": 2560\n        },\n        \"707584c1ae17d9b5b2cbe8603c91c147\": {\n            \"label\": \"Google Nexus 4\",\n            \"width\": 768,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 384,\n            \"dpHeight\": 2560\n        },\n        \"91823264de952e7f2347e07db5c4058b\": {\n            \"label\": \"Google Nexus 5\",\n            \"width\": 1080,\n            \"height\": 1920,\n            \"scaleFactor\": 3,\n            \"dpWidth\": 360,\n            \"dpHeight\": 5760\n        },\n        \"cd69817a6e147e8a4677389e56fcf568\": {\n            \"label\": \"Google Nexus S\",\n            \"width\": 480,\n            \"height\": 800,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1200\n        },\n        \"75994faa6a38e31e99b53fcd75534a33\": {\n            \"label\": \"HTC Evo, Touch HD, Desire HD, Desire\",\n            \"width\": 480,\n            \"height\": 800,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1200\n        },\n        \"0cab4dfccdfc880687cb608cfe4159db\": {\n            \"label\": \"HTC One X, EVO LTE\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 360,\n            \"dpHeight\": 2560\n        },\n        \"c4ff41fcba24d74fc21dc3490ca1edc9\": {\n            \"label\": \"HTC Sensation, Evo 3D\",\n            \"width\": 540,\n            \"height\": 960,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 360,\n            \"dpHeight\": 1440\n        },\n        \"fa969a5e0dd2de53700eeee4ba4ba142\": {\n            \"label\": \"LG Optimus 2X, Optimus 3D, Optimus Black\",\n            \"width\": 480,\n            \"height\": 800,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1200\n        },\n        \"33c4f9364e295ec03531f3a3425819cf\": {\n            \"label\": \"LG Optimus G\",\n            \"width\": 768,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 384,\n            \"dpHeight\": 2560\n        },\n        \"bc47f5275f0efd56fee52d43a8082981\": {\n            \"label\": \"LG Optimus LTE, Optimus 4X HD\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 1.7,\n            \"dpWidth\": 424,\n            \"dpHeight\": 2176\n        },\n        \"0732887e6e324fd10777b735520a34cf\": {\n            \"label\": \"LG Optimus One\",\n            \"width\": 320,\n            \"height\": 480,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 213,\n            \"dpHeight\": 720\n        },\n        \"2e38a78364f09d0da0e9e1a3a68e7fb0\": {\n            \"label\": \"Motorola Defy, Droid, Droid X, Milestone\",\n            \"width\": 480,\n            \"height\": 854,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1281\n        },\n        \"bd4b78dddc7c9625a4141a1b1ddabb87\": {\n            \"label\": \"Motorola Droid 3, Droid 4, Droid Razr, Atrix 4G, Atrix 2\",\n            \"width\": 540,\n            \"height\": 960,\n            \"scaleFactor\": 1,\n            \"dpWidth\": 540,\n            \"dpHeight\": 960\n        },\n        \"3bf1edf21cfa81006183d2b02974c84e\": {\n            \"label\": \"Motorola Droid Razr HD\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 1,\n            \"dpWidth\": 720,\n            \"dpHeight\": 1280\n        },\n        \"ab5a352e0e016b97dac986f06c394f55\": {\n            \"label\": \"Nokia C5, C6, C7, N97, N8, X7\",\n            \"width\": 360,\n            \"height\": 640,\n            \"scaleFactor\": 1,\n            \"dpWidth\": 360,\n            \"dpHeight\": 640\n        },\n        \"4826fb7d7257aeaac992ce699df41b3c\": {\n            \"label\": \"Nokia Lumia 7X0, Lumia 8XX, Lumia 900, N800, N810, N900\",\n            \"width\": 480,\n            \"height\": 800,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1200\n        },\n        \"0a691ab20add7c432200f8fa6527b488\": {\n            \"label\": \"Samsung Galaxy Note\",\n            \"width\": 800,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 400,\n            \"dpHeight\": 2560\n        },\n        \"9c23ee31be29960fbac9e9bbfc2fc7b0\": {\n            \"label\": \"Samsung Galaxy Note 3\",\n            \"width\": 1080,\n            \"height\": 1920,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 540,\n            \"dpHeight\": 3840\n        },\n        \"92177c0508c1d73905a58e2338f2a81f\": {\n            \"label\": \"Samsung Galaxy Note II\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 360,\n            \"dpHeight\": 2560\n        },\n        \"5222b8866dc4cc606725e16ffcc0a783\": {\n            \"label\": \"Samsung Galaxy S III, Galaxy Nexus\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 360,\n            \"dpHeight\": 2560\n        },\n        \"37c1541e2bd55cfd0f4073b0ccdf68b3\": {\n            \"label\": \"Samsung Galaxy S, S II, W\",\n            \"width\": 480,\n            \"height\": 800,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1200\n        },\n        \"2f7f64b7dda0144907ff300e83eed465\": {\n            \"label\": \"Samsung Galaxy S4\",\n            \"width\": 1080,\n            \"height\": 1920,\n            \"scaleFactor\": 3,\n            \"dpWidth\": 360,\n            \"dpHeight\": 5760\n        },\n        \"9c24f9057744dad56043702a9703127f\": {\n            \"label\": \"Sony Xperia S, Ion\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 360,\n            \"dpHeight\": 2560\n        },\n        \"0a8b2732a016a9395c3af5f12dd9c0da\": {\n            \"label\": \"Sony Xperia Sola, U\",\n            \"width\": 480,\n            \"height\": 854,\n            \"scaleFactor\": 1,\n            \"dpWidth\": 480,\n            \"dpHeight\": 854\n        },\n        \"5a153d7f53d82dcb0801f041574a6a43\": {\n            \"label\": \"Sony Xperia Z, Z1\",\n            \"width\": 1080,\n            \"height\": 1920,\n            \"scaleFactor\": 3,\n            \"dpWidth\": 360,\n            \"dpHeight\": 5760\n        }\n    },\n    \"screens\": {\n        \"9e523ae15b61dc766f5c818726881ecf\": {\n            \"label\": \"1920 \\u00d7 1080\",\n            \"width\": 1920,\n            \"height\": 1080,\n            \"dpWidth\": 1920,\n            \"dpHeight\": 1080,\n            \"scaleFactor\": 1\n        },\n        \"07769cd8d0a7d09818b2f0b018042fb7\": {\n            \"label\": \"1366 \\u00d7 768\",\n            \"width\": 1366,\n            \"height\": 768,\n            \"dpWidth\": 1366,\n            \"dpHeight\": 768,\n            \"scaleFactor\": 1\n        },\n        \"72d5478a24194f98b9378e8e0fd65737\": {\n            \"label\": \"1280 \\u00d7 1024\",\n            \"width\": 1280,\n            \"height\": 1024,\n            \"dpWidth\": 1280,\n            \"dpHeight\": 1024,\n            \"scaleFactor\": 1\n        },\n        \"b7a6dd5900cc72e61f0d3479c7e314ec\": {\n            \"label\": \"1280 \\u00d7 800\",\n            \"width\": 1280,\n            \"height\": 800,\n            \"dpWidth\": 1280,\n            \"dpHeight\": 800,\n            \"scaleFactor\": 1\n        },\n        \"43193b0ff671a37d8232ab664190a125\": {\n            \"label\": \"1024 \\u00d7 768\",\n            \"width\": 1024,\n            \"height\": 768,\n            \"dpWidth\": 1024,\n            \"dpHeight\": 768,\n            \"scaleFactor\": 1\n        },\n        \"c29e48814af5443ff5688d9e967ce917\": {\n            \"label\": \"800 \\u00d7 600\",\n            \"width\": 800,\n            \"height\": 600,\n            \"dpWidth\": 800,\n            \"dpHeight\": 600,\n            \"scaleFactor\": 1\n        }\n    }\n};});\n\n","\ndefine('tpl!taoItems/preview/tpl/preview', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n                        <option value=\\\"\";\n  if (helper = helpers.value) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.value); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.selected), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</option>\\n                        \";\n  return buffer;\n  }\nfunction program2(depth0,data) {\n  \n  \n  return \"selected=\\\"selected\\\"\";\n  }\n\nfunction program4(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\n                    <select class=\\\"preview-theme-selector\\\">\\n                        \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.themes), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                    </select>\\n                    \";\n  return buffer;\n  }\n\nfunction program6(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n                        <option value=\\\"\";\n  if (helper = helpers.value) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.value); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-value=\\\"\";\n  if (helper = helpers.dataValue) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.dataValue); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.selected), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</option>\\n                        \";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"preview-overlay tao-scope overlay preview-\";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \" item-no-print\\\"\\n     style=\\\"display:none\\\">\\n    <div class=\\\"preview-container-outer\\\">\\n        <form class=\\\"preview-utility-bar plain\\\">\\n            <div class=\\\"preview-utility-bar-inner grid-row\\\">\\n\\n                <div class=\\\"col-4\\\">\\n                    <input type=\\\"hidden\\\" value=\\\"\\\" data-value=\\\"\\\" class=\\\"standard-device-selector preview-device-selector\\\" data-target=\\\"standard\\\">\\n                    <select class=\\\"preview-type-selector\\\">\\n                        \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.previewTypes), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                    </select>\\n                    \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.hasThemes), {hash:{},inverse:self.noop,fn:self.program(4, program4, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                </div>\\n                <div class=\\\"col-6 standard-only device-type-and-orientation\\\"></div>\\n                <div class=\\\"col-6 desktop-only device-type-and-orientation\\\">\\n                    <select class=\\\"desktop-device-selector preview-device-selector\\\" data-target=\\\"desktop\\\">\\n                        \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.desktopDevices), {hash:{},inverse:self.noop,fn:self.program(6, program6, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                    </select>\\n                </div>\\n                <div class=\\\"col-6 mobile-only device-type-and-orientation\\\">\\n                    <select class=\\\"mobile-device-selector preview-device-selector\\\" data-target=\\\"mobile\\\">\\n                        \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.mobileDevices), {hash:{},inverse:self.noop,fn:self.program(6, program6, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                    </select>\\n                    <select tabindex=\\\"-1\\\" class=\\\"mobile-orientation-selector orientation-selector\\\"\\n                            data-target=\\\"mobile\\\">\\n                        <option value=\\\"landscape\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Landscape\", options) : helperMissing.call(depth0, \"__\", \"Landscape\", options)))\n    + \"</option>\\n                        <option value=\\\"portrait\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Portrait\", options) : helperMissing.call(depth0, \"__\", \"Portrait\", options)))\n    + \"</option>\\n                    </select>\\n                </div>\\n                <div class=\\\"col-2\\\">\\n                    <span class=\\\"btn-info small preview-closer rgt\\\">\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Close\", options) : helperMissing.call(depth0, \"__\", \"Close\", options)))\n    + \"\\n                        <span class=\\\"icon-close r\\\"></span>\\n                    </span>\\n                </div>\\n            </div>\\n            <div class=\\\"preview-message-box\\\">\\n                <div class=\\\"feedback-info small\\\">\\n                    <span class=\\\"icon-info\\\"></span>\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This preview may be scaled to fit your screen. The final rendering may differ.\", options) : helperMissing.call(depth0, \"__\", \"This preview may be scaled to fit your screen. The final rendering may differ.\", options)))\n    + \"\\n                    <a href=\\\"#\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Don’t show this again!\", options) : helperMissing.call(depth0, \"__\", \"Don’t show this again!\", options)))\n    + \"</a>\\n                    <span title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove this message\", options) : helperMissing.call(depth0, \"__\", \"Remove this message\", options)))\n    + \"\\\" class=\\\"icon-close close-trigger\\\"></span>\\n                </div>\\n            </div>\\n        </form>\\n        <div class=\\\"preview-canvas\\\">\\n            <div class=\\\"preview-scale-container\\\">\\n                <div class=\\\"\";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"-preview-frame preview-outer-frame \";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"-preview-landscape\\\">\\n                    <div class=\\\"\";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"-preview-container preview-container\\\">\\n                        <div class=\\\"preview-item-container\\\"></div>\\n                    </div>\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n\\n\\n    <div id=\\\"preview-console\\\">\\n        <span class=\\\"icon-close preview-console-closer\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Close console\", options) : helperMissing.call(depth0, \"__\", \"Close console\", options)))\n    + \"\\\"></span>\\n        <div class=\\\"preview-console-header grid-row clearfix\\\">\\n            <ul class=\\\"col-10 plain action-bar extra-button-action-bar horizontal-action-bar\\\">\\n            </ul>\\n            <ul class=\\\"col-2 plain action-bar console-button-action-bar horizontal-action-bar\\\">\\n                <li class=\\\"small btn-info action action-button rgt\\\" id=\\\"preview-submit-button\\\">\\n                    <a class=\\\"li-inner\\\" href=\\\"#\\\">\\n                        <span class=\\\"label\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Submit\", options) : helperMissing.call(depth0, \"__\", \"Submit\", options)))\n    + \"</span>\\n                    </a>\\n                </li>\\n            </ul>\\n        </div>\\n        <div class=\\\"preview-console-body clear\\\">\\n            <ul></ul>\\n        </div>\\n    </div>\\n</div>\\n\\n\\n\\n\";\n  return buffer;\n  });\n});\n\n","\ndefine('css!taoItemsCss/preview',[],function(){});\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Techniologies SA\n *\n */\ndefine('taoItems/preview/preview',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'util/strPad',\n    'core/promise',\n    'json!taoItems/preview/resources/device-list.json',\n    'tpl!taoItems/preview/tpl/preview',\n    'ui/themes',\n    'ui/themeLoader',\n    'ui/modal',\n    'select2',\n    'jquery.cookie',\n    'css!taoItemsCss/preview'\n], function ($, _, __, strPad, Promise, deviceList, previewTpl, themeHandler, themeLoader) {\n    'use strict';\n\n\n    var overlay,\n        container,\n        orientation = 'landscape',\n        previewType = 'standard',\n        previewTypes = {\n            desktop: __('Desktop preview'),\n            mobile: __('Mobile preview'),\n            standard: __('Actual size')\n        },\n        themeObj = themeHandler.get('items') || {},\n        $doc = $(document),\n        $window = $(window),\n        $body = $(document.body),\n        screenSize = {\n            width: $window.innerWidth(),\n            height: $window.innerHeight()\n        },\n        sizeSettings = {\n            width: 0,\n            height: 0\n        },\n        scaleFactor = 1,\n        typeDependant,\n        $feedbackBox,\n        $console,\n        previewContainerMaxWidth,\n        itemUri,\n        winScrollObj = { x:0, y:0 };\n\n\n    /**\n     * Create data set for device selectors\n     *\n     * @param type\n     * @returns {Array}\n     * @private\n     */\n    var _getDeviceSelectorData = function (type) {\n\n        /*\n         * @todo\n         * The device list is currently based on the devices found on the Chrome emulator.\n         * This is not ideal and should be changed in the future.\n         * I have http://en.wikipedia.org/wiki/List_of_displays_by_pixel_density in mind but we\n         * will need to figure what criteria to apply when generating the list.\n         */\n        var devices = type === 'mobile' ? deviceList.tablets : deviceList.screens,\n            options = [];\n\n        _.forEach(devices, function (value) {\n\n            options.push({\n                value: value.label,\n                label: value.label,\n                dataValue: [value.width, value.height].join(','),\n                selected: previewType === value.label\n            });\n        });\n\n\n        return options;\n    };\n\n    /**\n     * Collect all elements that can toggle their class name between mobile-* and desktop-*\n     *\n     * @private\n     */\n    var _setupTypeDependantElements = function () {\n        typeDependant = overlay.add(overlay.find('.preview-scale-container').find('[class*=\"' + previewType + '\"]'));\n    };\n\n\n    /**\n     * Change the class name of all type dependant elements\n     *\n     * @param {String} newType\n     */\n    var _setPreviewType = function (newType) {\n\n        if (newType === previewType) {\n            return;\n        }\n        var re = new RegExp(previewType, 'g');\n\n        typeDependant.each(function (i, el) {\n            el.className = el.className.replace(re, newType);\n        });\n\n        previewType = newType;\n    };\n\n\n    /**\n     * Set orientation\n     *\n     * @param {String} newOrientation\n     * @private\n     */\n    var _setOrientation = function (newOrientation) {\n        if (newOrientation === orientation) {\n            return;\n        }\n\n        var re = new RegExp(orientation, 'g'),\n            previewFrame = $('.preview-outer-frame')[0];\n\n        previewFrame.className = previewFrame.className.replace(re, newOrientation);\n\n        // reset global orientation\n        orientation = newOrientation;\n    };\n\n    /**\n     * Scale devices down to fit screen\n     * @private\n     */\n    var _scale = function () {\n\n        _computeScaleFactor();\n\n        var $scaleContainer = $('.preview-scale-container'),\n            _scaleFactor = previewType === 'standard' ? 1 : scaleFactor,\n            containerScaledWidth = $scaleContainer.width() * _scaleFactor,\n            left = (screenSize.width - containerScaledWidth) / 2;\n\n        $scaleContainer.css({\n            left: left > 0 ? left : 0,\n            '-webkit-transform': 'scale(' + _scaleFactor + ',' + _scaleFactor + ')',\n            '-ms-transform': 'scale(' + _scaleFactor + ',' + _scaleFactor + ')',\n            'transform': 'scale(' + _scaleFactor + ',' + _scaleFactor + ')',\n            '-webkit-transform-origin': '0 0',\n            '-ms-transform-origin': '0 0',\n            'transform-origin': '0 0'\n        });\n    };\n\n    /**\n     * position the preview depending on the height of the toolbar\n     *\n     * @private\n     */\n    var _positionPreview = function () {\n        var topBarHeight = $(\".preview-utility-bar\").outerHeight();\n\n        overlay[0].style.top = topBarHeight + 'px';\n        overlay[0].style.maxHeight = 'calc(100vh - ' + topBarHeight + 'px - ' + $console.outerHeight() + 'px )';\n    };\n\n\n    /**\n     * Compute scale factor based on screen size and device size\n     *\n     * @private\n     */\n    var _computeScaleFactor = function () {\n\n        var scaleValues = {\n            x: 1,\n            y: 1\n        };\n\n        // 150/200 = device frames plus toolbar plus console plus some margin\n\n        var requiredSize = {\n            width: sizeSettings.width + 150,\n            height: sizeSettings.height + 275\n        };\n\n        if (requiredSize.width > screenSize.width) {\n            scaleValues.x = screenSize.width / requiredSize.width;\n        }\n\n        if (requiredSize.height > screenSize.height) {\n            scaleValues.y = screenSize.height / requiredSize.height;\n        }\n\n        scaleFactor = Math.min(scaleValues.x, scaleValues.y);\n    };\n\n    /**\n     * Add functionality to device selectors\n     *\n     * @private\n     */\n    var _setupDeviceSelectors = function () {\n\n\n        var previewDeviceSelectors = overlay.find('.preview-device-selector');\n\n        previewDeviceSelectors.on('change', function () {\n            var elem = $(this),\n                option = this.nodeName.toLowerCase() === 'select' ? this.options[this.selectedIndex] : this,\n                type = elem.data('target'),\n                val = $(option).data('value').split(','),\n                i = val.length,\n                container = overlay.find('.' + type + '-preview-container');\n\n\n            while (i--) {\n                val[i] = parseFloat(val[i]);\n            }\n\n            if (type === 'mobile' && orientation === 'portrait') {\n                sizeSettings = {\n                    width: val[1],\n                    height: val[0]\n                };\n            }\n            else {\n                sizeSettings = {\n                    width: val[0],\n                    height: val[1]\n                };\n            }\n\n            if (sizeSettings.width === container.width() && sizeSettings.height === container.height()) {\n                return false;\n            }\n\n            _setPreviewType(type);\n            container.css(sizeSettings);\n            _scale();\n            _adaptFrameSize();\n        });\n\n        previewDeviceSelectors.each(function () {\n            if (this.nodeName.toLowerCase() === 'select') {\n                $(this).select2({\n                    minimumResultsForSearch: -1\n                });\n            }\n        });\n    };\n\n    /**\n     * Setup orientation selector. There is no actual orientation switch for desktop but it could\n     * be added easily if required.\n     * @private\n     */\n    var _setupOrientationSelectors = function () {\n\n        $('select.orientation-selector').on('change',function () {\n\n            var type = $(this).data('target'),\n                previewFrame = $('.' + type + '-preview-frame'),\n                container = previewFrame.find('.' + type + '-preview-container'),\n                newOrientation = $(this).val();\n\n            if (newOrientation === orientation) {\n                return false;\n            }\n\n            sizeSettings = {\n                height: container.width(),\n                width: container.height()\n            };\n\n            container.css(sizeSettings);\n\n            _setOrientation(newOrientation);\n\n            _scale();\n            _adaptFrameSize();\n\n\n        }).select2({\n            minimumResultsForSearch: -1\n        });\n    };\n\n    /**\n     * Close preview\n     *\n     * @returns {*|HTMLElement}\n     */\n    var _setupClosers = function () {\n        var $closer = overlay.find('.preview-closer'),\n            $feedbackCloser = $feedbackBox.find('.close-trigger'),\n            $hideForever = $feedbackBox.find('a');\n        var $iframe = $('#preview-iframe');\n\n        $closer.on('click', function () {\n            $doc.trigger('itemunload.preview');\n//            commonRenderer.setContext($('.item-editor-item'));\n\n            window.scrollTo(winScrollObj.x, winScrollObj.y);\n\n            overlay.hide();\n            $body.removeClass('preview-mode');\n\n            //empty the iframe\n            $iframe.off('load').attr('src', 'about:blank');\n        });\n\n        $doc.keyup(function (e) {\n            if (e.keyCode === 27) {\n                $closer.trigger('click');\n            }\n        });\n\n        $feedbackCloser.on('click', function () {\n            $feedbackBox.hide();\n            $body.addClass('no-preview-feedback');\n            _positionPreview();\n            _scale();\n        });\n\n        $hideForever.on('click', function (e) {\n            e.preventDefault();\n            $.cookie('hidePreviewFeedback', true, { expires: 1000, path: '/' });\n            $feedbackCloser.trigger('click');\n        });\n    };\n\n    /**\n     * Build options for themes\n     *\n     * @todo is there a way to know the selected theme?\n     *\n     * @returns {Array}\n     * @private\n     */\n    var _getThemes = function() {\n\n        var activeTheme = themeLoader(themeObj).getActiveTheme();\n\n        var options = [];\n        _(themeObj.available).forEach(function (data) {\n            options.push({\n                value: data.id,\n                label: data.name,\n                selected: data.id === activeTheme\n            });\n        });\n        return options;\n    };\n\n    /**\n     * Build options for preview types\n     *\n     * @returns {Array}\n     * @private\n     */\n    var _getPreviewTypes = function () {\n        var options = [];\n        _(previewTypes).forEach(function (_previewLabel, _previewType) {\n            options.push({\n                value: _previewType,\n                label: _previewLabel,\n                selected: previewType === _previewType\n            });\n        });\n        return options;\n    };\n\n    /**\n     * Select preview type\n     *\n     * @private\n     */\n    var _setupViewSelector = function () {\n\n        $('select.preview-type-selector').on('change',function () {\n            var _previewType = $(this),\n                value = _previewType.val();\n\n            _setPreviewType(value);\n\n            $('.' + value + '-device-selector').trigger('change');\n        }).select2({\n            minimumResultsForSearch: -1\n        });\n\n    };\n\n\n    /**\n     * Select preview theme\n     *\n     * @private\n     */\n    var _setupThemeSelector = function () {\n        $('select.preview-theme-selector').on('change',function () {\n            var iframe = document.getElementById('preview-container');\n            var iframeDoc = iframe.contentWindow || iframe.contentDocument;\n            iframeDoc.$('.qti-item').trigger('themechange', [$(this).val()]);\n\n        }).select2({\n            minimumResultsForSearch: -1\n        });\n\n    };\n\n    var _adaptFrameSize = function () {\n\n        var $previewContainer = $('.preview-container'),\n            $iframe = (function () {\n                var _iframe = $previewContainer.find('iframe');\n                _iframe.height('');\n                return _iframe;\n            }()),\n            contentHeight = $iframe.contents().outerHeight(),\n            containerHeight = $previewContainer.innerHeight();\n\n        if (previewType !== 'standard') {\n            if (contentHeight < containerHeight) {\n                contentHeight = containerHeight;\n            }\n        }\n        else {\n            $previewContainer.height(contentHeight + 10);\n        }\n\n        $iframe.height(contentHeight);\n    };\n\n\n    /**\n     * Set the size for the standard preview\n     * @param height\n     * @private\n     */\n    var _updateStandardPreviewSize = function (height) {\n        var $selector = $('.standard-device-selector'),\n            values = ($selector.val() ? $selector.val().split(',') : '') || [$window.width().toString()],\n            valueStr = values.join(',');\n\n        values[1] = height || values[1] || '1200';\n\n        $selector.val(valueStr).data('value', valueStr);\n    };\n\n\n    /**\n     * Console\n     *\n     * @private\n     */\n    var _initConsole = function () {\n        var $body = $console.find('.preview-console-body'),\n            $listing = $body.find('ul'),\n            $closer = $console.find('.preview-console-closer');\n\n        $console.off('updateConsole').on('updateConsole', function (event, type, message) {\n            var timer = new Date(),\n                logTime = [\n                    strPad(timer.getHours(), 2, '0', 'STR_PAD_LEFT'),\n                    strPad(timer.getMinutes(), 2, '0', 'STR_PAD_LEFT'),\n                    strPad(timer.getSeconds(), 2, '0', 'STR_PAD_LEFT')\n                ].join(':'),\n                msgStr = '<span class=\"log-time\">' + strPad(logTime, 12, ' ') + '</span> ' +\n                    '<span class=\"log-type\">' + strPad(type, 18, ' ') + '</span> ' +\n                    '<span class=\"log-message\">' + strPad(message, 18, ' ') + '</span>';\n            $listing.append('<li><pre>' + msgStr + '</pre></li>');\n            if (!$body.is(':visible')) {\n                $body.slideDown('slow', function () {\n                    $closer.show();\n                    $listing.scrollTop(10000);\n                });\n            }\n            else {\n                $listing.scrollTop(10000);\n            }\n        });\n\n        $closer.on('click', function () {\n            $body.slideUp('slow', function () {\n                $closer.hide();\n            });\n        });\n    };\n\n\n\n    /**\n     * Display the preview\n     * @returns {Promise} resolve once the preview is shown\n     */\n    var show = function () {\n        return new Promise(function (resolve, reject){\n            $.ajax({\n                url: itemUri,\n                dataType: 'html'\n            }).done(function (data) {\n\n                winScrollObj = { x: window.scrollX, y: window.scrollY };\n                window.scrollTo(0,0);\n\n                $body.addClass('preview-mode');\n\n                // $.show() does not work from the item manager\n                // this is either a miracle or a jquery bug\n                // overlay.hide().show();\n                overlay[0].style.display = 'block';\n\n                overlay.find('select:visible').not('.preview-theme-selector').trigger('change');\n                _scale();\n                _positionPreview();\n\n                $('.preview-item-container').html(data);\n                resolve();\n\n            }).fail(function(xhr){\n                reject(new Error(__('Unable to render the item from %s : %s %s', itemUri, xhr.status, xhr.statusText)));\n            });\n        });\n    };\n\n    /**\n     * Setting up screen size according preview viewport size\n     * @private\n     */\n    function _setupScreenSize() {\n        screenSize = {\n            width: $('.preview-overlay').innerWidth(),\n            height: $('.preview-overlay').innerHeight()\n        };\n    }\n\n    /**\n     * Create preview\n     *\n     * @param {String} _itemUri\n     */\n    var init = function (_itemUri) {\n\n        if(!_itemUri || _itemUri.length === 0){\n            throw new TypeError('Wrong URI');\n        }\n\n        $('.preview-overlay').remove();\n        container = null;\n        overlay = $(previewTpl({\n            mobileDevices: _getDeviceSelectorData('mobile'),\n            desktopDevices: _getDeviceSelectorData('desktop'),\n            previewTypes: _getPreviewTypes(),\n            previewType: previewType,\n            themes: _getThemes(),\n            hasThemes: _.size(themeObj.available) > 1\n        }));\n\n        $body.append(overlay);\n\n        previewContainerMaxWidth = parseInt($('.preview-container').css('max-width'), 10);\n\n        $feedbackBox = overlay.find('.preview-message-box');\n        if ($.cookie('hidePreviewFeedback')) {\n            $feedbackBox.hide();\n            $body.addClass('no-preview-feedback');\n        }\n\n        $console = overlay.find('#preview-console');\n\n        _initConsole();\n        _updateStandardPreviewSize();\n        _setupTypeDependantElements();\n        _setupDeviceSelectors();\n        _setupOrientationSelectors();\n        _setupViewSelector();\n        _setupThemeSelector();\n        _setupClosers();\n        _setupScreenSize();\n        _computeScaleFactor();\n        _setPreviewType(previewType);\n        _setOrientation(orientation);\n\n        $window.on('resize orientationchange', function () {\n            _setupScreenSize();\n            _updateStandardPreviewSize();\n            _computeScaleFactor();\n            _scale();\n        });\n\n        itemUri = _itemUri;\n\n        return overlay;\n    };\n\n    return {\n        init: init,\n        show: show\n    };\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Techniologies SA\n *\n */\ndefine('taoItems/controller/items/action',[\n    'layout/actions/binder',\n    'uri',\n    'jquery',\n    'context',\n    'taoItems/preview/preview',\n    'helpers'\n], function(binder, uri, $, context, preview, helpers){\n    'use strict';\n\n    binder.register('itemPreview', function itemPreview(actionContext){\n        preview.init(helpers._url('forwardMe', 'ItemPreview', context.shownExtension, {uri : actionContext.id}));\n        preview.show();\n    });\n\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA;\n */\ndefine('taoItems/controller/items/edit',[\n    'jquery',\n    'i18n',\n    'module',\n    'layout/actions',\n    'ui/lock',\n    'layout/section'\n],\nfunction($, __, module, actions, lock, section){\n    'use strict';\n\n    /**\n     * The item properties controller\n     */\n    var editItemController = {\n\n        /**\n         * Controller entry point\n         */\n        start : function start(){\n            var config = module.config();\n\n            var isPreviewEnabled = !!config.isPreviewEnabled;\n            var isAuthoringEnabled = !!config.isAuthoringEnabled;\n\n            var previewAction = actions.getBy('item-preview');\n            var authoringAction = actions.getBy('item-authoring');\n\n            if(previewAction){\n                previewAction.state.disabled = !config.isPreviewEnabled;\n            }\n            if(authoringAction){\n                authoringAction.state.disabled = !config.isAuthoringEnabled;\n            }\n            actions.updateState();\n\n            $('#lock-box').each(function() {\n                lock($(this)).register();\n            });\n\n            //some of the others sections (like the authoring) might have an impact\n            //on the state of the other actions, so we reload when we come back\n            section\n                .off('show')\n                .on('show', function(sectionContext){\n                    if(sectionContext.id === 'manage_items'){\n                        actions.exec('item-properties');\n                    }\n                });\n        }\n    };\n\n    return editItemController;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\ndefine('serviceApi/ServiceApi',['jquery', 'urlParser'], function($, UrlParser){\n    'use strict';\n\n    /**\n     * @constructor\n     */\n    function ServiceApi(baseUrl, parameters, serviceCallId, stateStorage, userService, paused){\n        this.baseUrl = baseUrl;\n        this.parameters = parameters;\n        this.connected = false;\n\n        this.serviceCallId = serviceCallId;\n        this.state = stateStorage;\n        this.userService = userService;\n        this.hasBeenPaused = paused;\n    }\n\n    ServiceApi.SIG_SUCCESS = 0;\n    ServiceApi.SIG_ERROR = 1;\n\n    ServiceApi.prototype.loadInto = function(frame, connected){\n        var self = this;\n        var $frame = $(frame);\n        var callUrl = this.getCallUrl();\n        var isCORSAllowed = new UrlParser(callUrl).checkCORS();\n\n        $frame.on('load', function(e){\n             //if we are  in the same domain, we add a variable\n             //to the frame window, so the frame knows it can communicate\n             //with the parent\n            $(document).on('serviceready', function(){\n                self.connect(frame, function(){\n                    $(document).off('serviceready');\n                    if(typeof connected === 'function'){\n                        connected();\n                    }\n                });\n            });\n             if(isCORSAllowed === true){\n                 frame.contentWindow.__knownParent__ = true;\n             }\n         });\n\n        $frame.attr('src', callUrl);\n    };\n\n    ServiceApi.prototype.connect = function(frame, connected){\n        if(this.connected === false && frame.contentWindow){\n            //frame.contentWindow.serviceApi = this;\n            if (typeof(frame.contentWindow.onServiceApiReady) === \"function\") {\n                frame.contentWindow.onServiceApiReady(this);\n                this.connected = true;\n                if(typeof connected === 'function'){\n                    connected();\n                }\n            }\n        }\n    };\n\n    /**\n     * Get the service call URL\n     * @returns {String} the URI\n     */\n    ServiceApi.prototype.getCallUrl = function(){\n        var params = this.parameters || {};\n        params.serviceCallId = this.serviceCallId;\n        return this.baseUrl + '?' + $.param(params);\n    };\n\n    ServiceApi.prototype.getUserPropertyValues = function(property, callback){\n    \tthis.userService.get(property, callback);\n    };\n\n    //Context\n    ServiceApi.prototype.getServiceCallId = function(){\n        return this.serviceCallId;\n    };\n\n    //Context\n    ServiceApi.prototype.getState = function(){\n        return this.state.get();\n    };\n\n    ServiceApi.prototype.setState = function(state, callback){\n        return this.state.set(state, callback);\n    };\n\n    //Context\n    ServiceApi.prototype.getHasBeenPaused = function(){\n        return this.hasBeenPaused;\n    };\n\n    ServiceApi.prototype.setHasBeenPaused = function(paused){\n        this.hasBeenPaused = paused;\n    };\n\n    // Variables\n    ServiceApi.prototype.getParameter = function(identifier){\n        if (typeof(this.parameters[identifier]) !== \"undefined\") {\n            return this.parameters[identifier];\n        } else {\n            return null;\n        }\n    };\n\n    /**\n     * Sets a callback on the finish action\n     * @param {Function} callback\n     * @returns {ServiceApi}\n     */\n    ServiceApi.prototype.onFinish = function(callback) {\n        this.onFinishCallback = callback;\n        return this;\n    };\n\n    /**\n     * Sets a callback on the kill action\n     * @param {Function} callback\n     * @returns {ServiceApi}\n     */\n    ServiceApi.prototype.onKill = function(callback) {\n        this.onKillCallback = callback;\n        return this;\n    };\n\n    /**\n     * Sets a callback on the exit action\n     * @param {Function} callback\n     * @returns {ServiceApi}\n     */\n    ServiceApi.prototype.onExit = function(callback) {\n        this.onExitCallback = callback;\n        return this;\n    };\n\n    /**\n     * @param {Function} callback - Function called if no dedicated callback is found\n     */\n    ServiceApi.prototype.kill = function(callback) {\n    \tif (typeof this.onKillCallback === 'function') {\n    \t\tthis.onKillCallback(callback);\n    \t} else {\n    \t\tcallback(0);\n    \t}\n    };\n\n    /**\n     * Exits the flow\n     * @param {Function} callback - Function called if no dedicated callback is found\n     */\n    ServiceApi.prototype.exit = function(callback) {\n    \tif (typeof this.onExitCallback === 'function') {\n    \t\tthis.onExitCallback(callback);\n    \t} else {\n    \t\tcallback(0);\n    \t}\n    };\n\n    /**\n     * Finishes the flow\n     * @param valueArray - return parameters of the service.\n     */\n    ServiceApi.prototype.finish = function(valueArray) {\n        //return execution to service caller\n        if (typeof this.onFinishCallback === 'function') {\n                this.onFinishCallback(valueArray);\n        }\n    };\n\n    return ServiceApi;\n\n});\n\n","define('serviceApi/PseudoStorage',[],function(){\n    \n    function PseudoStorage() {\n    }\n\n    PseudoStorage.prototype.get = function(callback){\n        if (typeof callback === 'function') {\n            callback(null);\n        }\n        return null;\n    };\n\n    PseudoStorage.prototype.set = function(state, callback){\n        if (typeof callback === \"function\") {\n            callback();\n        }\n    };\n\n    return PseudoStorage;\n});\n","define('serviceApi/UserInfoService',['jquery'], function($){\n    \n    function UserInfoService(requestUrl, data) {\n        this.data = data;\n        this.requestUrl = requestUrl;\n    }\n\n    UserInfoService.prototype.get = function(property, callback){\n        if (this.data.hasOwnProperty(property)) {\n            if (typeof callback === \"function\") {\n                    callback(this.data[property]);\n            }\n        } else {\n            $.ajax({\n                url : this.requestUrl,\n                data \t\t: {\n                    'property' : property\n                },\n                type        : 'post',\n                dataType\t: 'json',\n                success     : (function(service, callback) {return function(r) {\n            \t\tfor (key in r.data) {\n            \t\t\tservice.data[key] = r.data[key];\n            \t\t}\n                    if (typeof callback === \"function\") {\n                        callback(service.data[property]);\n                    }\n\n                }})(this, callback)\n                /*\t\n            \tfunction(r){\n                    if(r.success){\n                    \tconsole.log(this.data);\n                    \tthis.data[property] = r.values;\n                    \t//console.log(this.data);\n\t                    if (typeof callback === \"function\") {\n\t                        callback(this.data[property]);\n\t                    }\n                    }\n                }\n                */\n                \n                \n            });\n        }\n    };\n\n    return UserInfoService;\n});\n","define('taoItems/runtime/ItemServiceImpl',[ 'jquery' ], function($) {\n\n    function ItemServiceImpl(data) {\n\n        this.itemId = data.itemId;\n        this.serviceApi = data.serviceApi;\n        this.resultApi = data.resultApi || null;\n        this.params = data.params || {};\n        this.responses = {};\n        this.scores = {};\n        this.events = {};\n        this.connected = false;\n\n        var rawstate = this.serviceApi.getState();\n        var state = (typeof rawstate === 'undefined' || rawstate === null) ? {}\n                : $.parseJSON(rawstate);\n        this.stateVariables = typeof state === 'object' ? state : {};\n\n        this.beforeFinishCallbacks = [];\n    }\n\n    ItemServiceImpl.prototype.connect = function(frame) {\n        if (this.connected === false && frame.contentWindow) {\n            frame.contentWindow.itemApi = this;\n            \n            if (typeof (frame.contentWindow.onItemApiReady) === \"function\") {\n                frame.contentWindow.onItemApiReady(this);\n                this.connected = true;\n            }\n        }\n    };\n\n    // Response\n\n    ItemServiceImpl.prototype.saveResponses = function(valueArray) {\n        for ( var attrname in valueArray) {\n            this.responses[attrname] = valueArray[attrname];\n        }\n    };\n\n    ItemServiceImpl.prototype.traceEvents = function(eventArray) {\n        for ( var attrname in eventArray) {\n            this.events[attrname] = eventArray[attrname];\n        }\n    };\n\n    // Scoring\n    ItemServiceImpl.prototype.saveScores = function(valueArray) {\n        for ( var attrname in valueArray) {\n            this.scores[attrname] = valueArray[attrname];\n        }\n    };\n\n    ItemServiceImpl.prototype.getUserPropertyValues = function(property,\n            callback) {\n        this.serviceApi.getUserPropertyValues(property, callback);\n    };\n\n    // Flow\n    ItemServiceImpl.prototype.beforeFinish = function(callback) {\n        this.beforeFinishCallbacks.push(callback);\n    };\n\n    ItemServiceImpl.prototype.finish = function() {\n        var self = this;\n        for ( var i = 0; i < this.beforeFinishCallbacks.length; i++) {\n            this.beforeFinishCallbacks[i]();\n        }\n\n        this.submit(function() {\n            self.serviceApi.finish();\n        });\n    };\n\n    ItemServiceImpl.prototype.submit = function(after) {\n        var self = this;\n\n        this.serviceApi.setState(JSON.stringify(self.stateVariables),\n                function() {\n                    // todo add item, call id etc\n\n                    if (self.resultApi) {\n                        self.resultApi\n                                .submitItemVariables(self.itemId,\n                                        self.serviceApi.getServiceCallId(),\n                                        self.responses, self.scores,\n                                        self.events, self.params, after);\n                    } else {\n                        after();\n                    }\n                });\n    }\n\n    ItemServiceImpl.prototype.onKill = function(callback) {\n        this.serviceApi.onKill(callback);\n    };\n\n    ItemServiceImpl.prototype.getVariable = function(identifier, callback) {\n        if (typeof callback === 'function') {\n            callback(this.stateVariables[identifier] || null);\n        }\n    };\n\n    ItemServiceImpl.prototype.setVariable = function(identifier, value) {\n        this.stateVariables[identifier] = value;\n        this.serviceApi.setState(JSON.stringify(this.stateVariables));\n    };\n    \n    ItemServiceImpl.prototype.setVariables = function(values) {\n        for(var v in values){\n            this.stateVariables[v] = values[v];\n        }\n        this.serviceApi.setState(JSON.stringify(this.stateVariables));\n    };\n    \n    return ItemServiceImpl;\n});\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA ;\n *\n */\n\n/**\n * This module allows adding extra buttons in the action bar of the test runner\n *\n */\ndefine('taoItems/preview/actionBarHook',[\n    'jquery',\n    'lodash',\n    'core/errorHandler',\n    'core/promise'\n], function ($, _, errorHandler, Promise) {\n\n    'use strict';\n\n    /**\n     * Events namespace\n     * @type {String}\n     * @private\n     */\n    var _ns = '.previewActionBarHook';\n\n\n    /**\n     * List of loaded and visible hooks\n     * @type {Object}\n     * @private\n     */\n    var tools = {};\n\n\n    /**\n     *\n     * @type {*|jQuery|HTMLElement}\n     */\n    var $toolContainers = $();\n\n\n    /**\n     * Remove tools when closing the item\n     */\n    $(document).off('.preview').on('itemunload.preview', function () {\n        $toolContainers.each(function () {\n            var $toolContainer = $(this);\n            _.forEach(tools, function (tool, id) {\n                var $btn = $toolContainer.children('[data-control=\"' + id + '\"]');\n                if ($btn.length) {\n                    tool.clear($btn);\n                    $btn.remove();\n                }\n            });\n        });\n    });\n\n\n    /**\n     * Check that the toolConfig is correct\n     *\n     * @param {Object} toolconfig\n     * @param {String} toolconfig.hook - the amd module to be loaded to initialize the button\n     * @param {String} [toolconfig.label] - the label to be displayed in the button\n     * @param {String} [toolconfig.icon] - the icon to be displayed in the button\n     * @param {String} [toolconfig.title] - the title to be displayed in the button\n     * @param {Array} [toolconfig.items] - an optional list of menu items\n     * @returns {Boolean}\n     */\n    function isValidConfig(toolconfig) {\n        return !!(_.isObject(toolconfig) && toolconfig.hook);\n    }\n\n    /**\n     * Triggers the itemLoaded event inside the provided actionBar hook\n     * @param {Object} tool\n     */\n    function triggerItemLoaded(tool) {\n        if (tool && tool.itemLoaded) {\n            tool.itemLoaded();\n        }\n    }\n\n    /**\n     * Init a test runner button from its config\n     *\n     * @param {String} id\n     * @param {Object|String} toolconfig\n     * @param {String} toolconfig.hook - the amd module to be loaded to initialize the button\n     * @param {String} [toolconfig.label] - the label to be displayed in the button\n     * @param {String} [toolconfig.icon] - the icon to be displayed in the button\n     * @param {String} [toolconfig.title] - the title to be displayed in the button\n     * @param {Array} [toolconfig.items] - an optional list of menu items\n     * // @param {Object} testContext - the complete state of the test\n     * @param {Object} testRunner - the test runner instance\n     * @fires ready.actionBarHook when the hook has been initialized\n     * @returns {Promise}\n     */\n    function initExtraButtons($toolContainer, id, toolconfig) {\n\n        if (_.isString(toolconfig)) {\n            toolconfig = {\n                hook: toolconfig\n            };\n        }\n\n        tools[id] = null;\n\n        $toolContainers = $toolContainers.add($toolContainer);\n\n        return new Promise(function(resolve) {\n            if (isValidConfig(toolconfig)) {\n\n                require([toolconfig.hook], function (hook) {\n\n                    var $button;\n                    var $existingBtn;\n\n                    if (isValidHook(hook)) {\n                        //init the control\n                        hook.init(id, toolconfig);\n\n                        //if an instance of the tool is already attached, remove it:\n                        $existingBtn = $toolContainer.children('[data-control=\"' + id + '\"]');\n                        if ($existingBtn.length) {\n                            hook.clear($existingBtn);\n                            $existingBtn.remove();\n                        }\n\n                        //keep access to the tool\n                        tools[id] = hook;\n\n                        // renders the button from the config\n                        $button = hook.render();\n\n                        //only attach the button to the dom when everything is ready\n                        _appendInOrder($toolContainer, $button);\n\n                        //ready !\n                        $button.trigger('ready' + _ns, [hook]);\n\n                        triggerItemLoaded(hook);\n\n                        resolve(hook);\n                    } else {\n                        errorHandler.throw(_ns, 'invalid hook format');\n                        resolve(null);\n                    }\n\n                }, function (e) {\n                    errorHandler.throw(_ns, 'the hook amd module cannot be found');\n                    resolve(null);\n                });\n\n            } else {\n                errorHandler.throw(_ns, 'invalid tool config format');\n                resolve(null);\n            }\n        });\n    }\n\n    /**\n     * Append a dom element $button to a $container in a specific order\n     * The orders are provided by data-order attribute set to the $button\n     *\n     * @param {JQuery} $container\n     * @param {JQuery} $button\n     */\n    function _appendInOrder($container, $button) {\n\n        var $after, $before;\n        var order = $button.data('order');\n\n        if ('last' === order) {\n\n            $container.append($button);\n\n        } else if ('first' === order) {\n\n            $container.prepend($button);\n\n        } else {\n\n            order = _.parseInt(order);\n            if (!_.isNaN(order)) {\n\n                $container.children('.action').each(function () {\n\n                    var $btn = $(this),\n                        _order = $btn.data('order');\n\n                    if ('last' === _order) {\n\n                        $before = $btn;\n                        $after = null;\n\n                    } else if ('first' === _order) {\n\n                        $before = null;\n                        $after = $btn;\n\n                    } else {\n\n                        _order = _.parseInt(_order);\n\n                        if (_.isNaN(_order) || _order > order) {\n                            $before = $btn;\n                            $after = null;\n                            //stops here because $container children returns the dom elements in the dom order\n                            return false;\n                        } else if (_order === order) {\n                            $after = $btn;\n                        } else if (_order < order) {\n                            $after = $btn;\n                            $before = null;\n                        }\n\n                    }\n\n                });\n\n                if ($after) {\n                    $after.after($button);\n                } else if ($before) {\n                    $before.before($button);\n                } else {\n                    $container.append($button);\n                }\n\n            } else {\n                //unordered buttons are append at the end (including when order equals 0)\n                $container.append($button);\n            }\n        }\n    }\n\n    /**\n     * Check if the hook object is valid\n     *\n     * @param {Object} hook\n     * @param {Function} hook.init\n     * @param {Function} hook.clear\n     * @param {Function} hook.isVisible\n     * @returns {Boolean}\n     */\n    function isValidHook(hook) {\n        return (_.isObject(hook) && _(['init', 'render', 'clear', 'isVisible']).reduce(function (result, method) {\n            return result && _.isFunction(hook[method]);\n        }, true));\n    }\n\n    return {\n        isValid: isValidConfig,\n        initExtraButtons: initExtraButtons\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoItems/controller/preview/itemRunner',[\n    'module',\n    'jquery',\n    'lodash',\n    'serviceApi/ServiceApi',\n    'serviceApi/PseudoStorage',\n    'serviceApi/UserInfoService',\n    'taoItems/runtime/ItemServiceImpl',\n    'taoItems/preview/actionBarHook',\n    'urlParser'\n], function (\n    module,\n    $,\n    _,\n    ServiceApi,\n    PseudoStorage,\n    UserInfoService,\n    ItemServiceImpl,\n    actionBarHook,\n    UrlParser\n) {\n    'use strict';\n\n\n        /**\n         * Custom Buttons, usually defined in a custom extension\n         *\n         * @private\n         */\n        var _initCustomButtons = function _initCustomButtons() {\n\n            var config = module.config(),\n                buttons = config.extraButtons || {},\n                $container = $('.extra-button-action-bar');\n\n\n            _.forIn(buttons, function(config, id) {\n                actionBarHook.initExtraButtons($container, id, config);\n            });\n\n        };\n\n        var previewItemRunner = {\n\n            start: function (options) {\n\n                var conf = _.merge(module.config(), options || {});\n\n                if (conf.previewUrl) {\n\n                    var resultServer = _.defaults(conf.resultServer, {\n                        module: 'taoResultServer/ResultServerApi',\n                        endpoint: '',\n                        params: {}\n                    });\n\n                    //load dynamically the right ResultServerApi\n                    require([resultServer.module], function (ResultServerApi) {\n\n                        var resultServerApi = new ResultServerApi(\n                            resultServer.endpoint,\n                            resultServer.params\n                        );\n\n                        var serviceApi = new ServiceApi(\n                            conf.previewUrl,\n                            {},\n                            'preview',\n                            new PseudoStorage(),\n                            new UserInfoService(conf.userInfoServiceRequestUrl, {})\n                        );\n\n                        var itemApi = new ItemServiceImpl({\n                            serviceApi: serviceApi,\n                            resultApi: resultServerApi\n                        });\n\n                        var callUrl = new UrlParser(serviceApi.getCallUrl());\n                        var isCORSAllowed = callUrl.checkCORS();\n                        callUrl.addParam('clientConfigUrl', conf.clientConfigUrl);\n\n                        //the iframe is 1st detached and then attached with src in order to prevent adding an entry in the history\n                        var $frame = $('<iframe id=\"preview-container\" name=\"preview-container\" src=\"' + callUrl.getUrl() + '\"></iframe>');\n\n\n                        $frame.on('load', function () {\n                            var frame = this;\n\n                            //1st try to connect the api on frame load\n                            itemApi.connect(frame);\n\n                            //if we are  in the same domain, we add a variable\n                            //to the frame window, so the frame knows it can communicate\n                            //with the parent\n                            if (isCORSAllowed === true) {\n                                frame.contentWindow.__knownParent__ = true;\n                            }\n                            //then we can wait a specific event triggered from the item\n                            $(document).off('itemready').on('itemready', function () {\n                                itemApi.connect(frame);\n                                if(frame.contentWindow.__knownParent__) {\n                                    frame.contentWindow.document.body.className += ' tao-preview-scope';\n\n                                    _initCustomButtons();\n                                }\n                            });\n                        });\n\n                        $('.preview-item-container').append($frame);\n\n                        $('#finishButton').click(function () {\n                            itemApi.finish();\n                        });\n                    });\n                }\n            }\n        };\n\n        return previewItemRunner;\n    });\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoItems/controller/runtime/itemRunner',['jquery', 'lodash', 'iframeNotifier', 'urlParser'],\n    function($, _, iframeNotifier, UrlParser){\n        'use strict';\n\n        var itemRunner = {\n            start : function(options){\n\n                var $frame = $('<iframe id=\"item-container\" class=\"toolframe\" frameborder=\"0\" style=\"width:100%;\" scrolling=\"no\"></iframe>');\n                $frame.appendTo('body');\n                var itemId = options.itemId;\n                var itemPath = options.itemPath;\n                var resultServer = _.defaults(options.resultServer, {\n                    module : 'taoResultServer/ResultServerApi',\n                    params : {}\n                });\n                var itemService = _.defaults(options.itemService, {\n                    module : 'taoItems/runtime/ItemServiceImpl',\n                    params : {}\n                });\n                var clientConfigUrl = options.clientConfigUrl;\n                var timeout = options.timeout || 30;\n\n                //load dynamically the right ItemService and ResultServerApi\n                require([itemService.module, resultServer.module], function(ItemService, ResultServerApi){\n\n                    var resultServerApi = new ResultServerApi(resultServer.endpoint, resultServer.params);\n\n                    var setIframeHeight = function(newHeight) {\n\n                        var neverResized = $frame.height() === 150;\n\n                        var resize = function resize(newHeight, notifyParent) {\n                            $frame.css({height: newHeight});\n                            if(notifyParent) {\n                                iframeNotifier.parent('heightchange', newHeight);\n                            }\n                        };\n\n                        resize(newHeight || $frame.contents().outerHeight(true), !newHeight);\n\n                        if(neverResized) {\n                            _.delay(function() {\n                                resize($frame.contents().outerHeight(true), true);\n                            }, 200);\n                        }\n                    };\n\n                    window.onServiceApiReady = function(serviceApi){\n\n                        var itemApi = new ItemService(_.merge({\n                            serviceApi : serviceApi,\n                            itemId : itemId,\n                            resultApi : resultServerApi\n                        }, {\n                            params : itemService.params\n                        }));\n\n                        var itemUrl = new UrlParser(itemPath);\n                        var isCORSAllowed = itemUrl.checkCORS();\n                        itemUrl.addParam('clientConfigUrl', clientConfigUrl);\n                        itemUrl.addParam('timeout', timeout);\n\n                        $(document).on('itemloaded', function() {\n                            setIframeHeight();\n                            iframeNotifier.parent('serviceloaded');\n\n                            $frame.contents().find('img').on('load', _.throttle(function() {\n                                setIframeHeight();\n                            }, 50));\n                        }).on('responsechange', function(e, responseId, response){\n                            iframeNotifier.parent('responsechange', [responseId, response]);\n                        }).on('stateready', function(e, elmentId, state){\n                            iframeNotifier.parent('stateready', [elmentId, state]);\n                        }).on('itemready', function() {\n                            // item is ready, we can connect.\n                            itemApi.connect($frame[0]);\n                        }).on('itemcontentchange', function() {\n                            setIframeHeight();\n                        });\n\n                        $frame.on('load', function(){\n                            itemApi.connect($frame[0]);\n\n                            if (isCORSAllowed === true) {\n                                this.contentWindow.__knownParent__ = true;\n                            }\n\n                            $('body').on('setheight', function(event, height) {\n                                setIframeHeight(height);\n                            });\n                        });\n                        $frame.attr('src', itemUrl.getUrl());\n                    };\n\n                    //tell the parent he can trigger onServiceApiReady\n                    _.defer(function(){\n                        iframeNotifier.parent('serviceready');\n                    });\n                });\n            }\n        };\n\n        return itemRunner;\n    });\n\n"]}